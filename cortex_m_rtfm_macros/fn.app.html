<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `app` fn in crate `cortex_m_rtfm_macros`."><meta name="keywords" content="rust, rustlang, rust-lang, app"><title>cortex_m_rtfm_macros::app - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script></head><body class="rustdoc fn"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><div class="sidebar-elems"><p class='location'><a href='index.html'>cortex_m_rtfm_macros</a></p><script>window.sidebarCurrent = {name: 'app', ty: 'fn', relpath: ''};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><input class="search-input" name="search" autocomplete="off" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/cortex_m_rtfm_macros/lib.rs.html#170-175' title='goto source code'>[src]</a></span><span class='in-band'>Function <a href='index.html'>cortex_m_rtfm_macros</a>::<wbr><a class="fn" href=''>app</a></span></h1><pre class='rust fn'>pub fn app(ts: <a class="struct" href="https://doc.rust-lang.org/nightly/proc_macro/struct.TokenStream.html" title="struct proc_macro::TokenStream">TokenStream</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/proc_macro/struct.TokenStream.html" title="struct proc_macro::TokenStream">TokenStream</a></pre><div class='docblock'><p>The <code>app!</code> macro, a macro used to specify the tasks and resources of a RTFM application.</p>
<p>The contents of this macro uses a <code>key: value</code> syntax. All the possible keys are shown below:</p>
<pre><code class="language-text">app! {
    device: ..,

    resources: { .. },

    init: { .. },

    idle: { .. },

    tasks: { .. },
}
</code></pre>
<h1 id="device" class="section-header"><a href="#device"><code>device</code></a></h1>
<p>The value of this key is a Rust path, like <code>foo::bar::baz</code>, that must point to a <em>device crate</em>,
a crate generated using <code>svd2rust</code>.</p>
<h1 id="resources" class="section-header"><a href="#resources"><code>resources</code></a></h1>
<p>This key is optional. Its value is a list of <code>static</code> variables. These variables are the data
that can be safely accessed, modified and shared by tasks.</p>
<pre><code class="language-text">resources: {
    static A: bool = false;
    static B: i32 = 0;
    static C: [u8; 16] = [0; 16];
    static D: Thing = Thing::new(..);
    static E: Thing;
}
</code></pre>
<p>The initial value of a resource can be omitted. This means that the resource will be runtime
initialized; these runtime initialized resources are also known as <em>late resources</em>.</p>
<p>If this key is omitted its value defaults to an empty list.</p>
<h1 id="init" class="section-header"><a href="#init"><code>init</code></a></h1>
<p>This key is optional. Its value is a set of key values. All the possible keys are shown below:</p>
<pre><code class="language-text">init: {
    path: ..,
}
</code></pre>
<h2 id="initpath" class="section-header"><a href="#initpath"><code>init.path</code></a></h2>
<p>This key is optional. Its value is a Rust path, like <code>foo::bar::baz</code>, that points to the
initialization function.</p>
<p>If the key is omitted its value defaults to <code>init</code>.</p>
<h2 id="initresources" class="section-header"><a href="#initresources"><code>init.resources</code></a></h2>
<p>This key is optional. Its value is a set of resources the <code>init</code> function <em>owns</em>. The resources
in this list must be a subset of the resources listed in the top <code>resources</code> key. Note that some
restrictions apply:</p>
<ul>
<li>The resources in this list can't be late resources.</li>
<li>The resources that appear in this list can't appear in other list like <code>idle.resources</code> or
<code>tasks.$TASK.resources</code></li>
</ul>
<p>If this key is omitted its value is assumed to be an empty list.</p>
<h1 id="idle" class="section-header"><a href="#idle"><code>idle</code></a></h1>
<p>This key is optional. Its value is a set of key values. All the possible keys are shown below:</p>
<pre><code class="language-text">idle: {
    path: ..,
    resources: [..],
}
</code></pre>
<h2 id="idlepath" class="section-header"><a href="#idlepath"><code>idle.path</code></a></h2>
<p>This key is optional. Its value is a Rust path, like <code>foo::bar::baz</code>, that points to the idle
loop function.</p>
<p>If the key is omitted its value defaults to <code>idle</code>.</p>
<h2 id="idleresources" class="section-header"><a href="#idleresources"><code>idle.resources</code></a></h2>
<p>This key is optional. Its value is a list of resources the <code>idle</code> loop has access to. The
resources in this list must be a subset of the resources listed in the top <code>resources</code> key.</p>
<p>If omitted its value defaults to an empty list.</p>
<h1 id="tasks" class="section-header"><a href="#tasks"><code>tasks</code></a></h1>
<p>This key is optional. Its value is a list of tasks. Each task itself is a set of key value pair.
The full syntax is shown below:</p>
<pre><code class="language-text">tasks: {
    $TASK: {
        enabled: ..,
        path: ..,
        priority: ..,
        resources: [..],
    },
}
</code></pre>
<p>If this key is omitted its value is assumed to be an empty list.</p>
<h2 id="taskstask" class="section-header"><a href="#taskstask"><code>tasks.$TASK</code></a></h2>
<p>The key must be either a Cortex-M exception or a device specific interrupt. <code>PENDSV</code>, <code>SVCALL</code>,
<code>SYS_TICK</code> are considered as exceptions. All other names are assumed to be interrupts.</p>
<h2 id="taskstaskenabled" class="section-header"><a href="#taskstaskenabled"><code>tasks.$TASK.enabled</code></a></h2>
<p>This key is optional for interrupts and forbidden for exceptions. Its value must be a boolean
and indicates whether the interrupt will be enabled (<code>true</code>) or disabled (<code>false</code>) after <code>init</code>
ends and before <code>idle</code> starts.</p>
<p>If this key is omitted its value defaults to <code>true</code>.</p>
<h2 id="taskstaskpath" class="section-header"><a href="#taskstaskpath"><code>tasks.$TASK.path</code></a></h2>
<p>The value of this key is a Rust path, like <code>foo::bar::baz</code>, that points to the handler of this
task.</p>
<h2 id="taskstaskpriority" class="section-header"><a href="#taskstaskpriority"><code>tasks.$TASK.priority</code></a></h2>
<p>This key is optional. Its value is an integer with type <code>u8</code> that specifies the priority of this
task. The minimum valid priority is 1. The maximum valid priority depends on the number of the
NVIC priority bits the device has; if the device has 4 priority bits the maximum allowed value
would be 16.</p>
<p>If this key is omitted its value defaults to <code>1</code>.</p>
<h2 id="taskstaskresources" class="section-header"><a href="#taskstaskresources"><code>tasks.$TASK.resources</code></a></h2>
<p>This key is optional. Its value is a list of resources this task has access to. The resources in
this list must be a subset of the resources listed in the top <code>resources</code> key.</p>
<p>If omitted its value defaults to an empty list.</p>
</div></section><section id="search" class="content hidden"></section><section class="footer"></section><aside id="help" class="hidden"><div><h1 class="hidden">Help</h1><div class="shortcuts"><h2>Keyboard Shortcuts</h2><dl><dt><kbd>?</kbd></dt><dd>Show this help dialog</dd><dt><kbd>S</kbd></dt><dd>Focus the search field</dd><dt><kbd>↑</kbd></dt><dd>Move up in search results</dd><dt><kbd>↓</kbd></dt><dd>Move down in search results</dd><dt><kbd>↹</kbd></dt><dd>Switch tab</dd><dt><kbd>&#9166;</kbd></dt><dd>Go to active search result</dd><dt><kbd>+</kbd></dt><dd>Expand all sections</dd><dt><kbd>-</kbd></dt><dd>Collapse all sections</dd></dl></div><div class="infos"><h2>Search Tricks</h2><p>Prefix searches with a type followed by a colon (e.g. <code>fn:</code>) to restrict the search to a given type.</p><p>Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, and <code>const</code>.</p><p>Search functions by type signature (e.g. <code>vec -> usize</code> or <code>* -> vec</code>)</p><p>Search multiple things at once by splitting your query with comma (e.g. <code>str,u8</code> or <code>String,struct:Vec,test</code>)</p></div></div></aside><script>window.rootPath = "../";window.currentCrate = "cortex_m_rtfm_macros";</script><script src="../aliases.js"></script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>